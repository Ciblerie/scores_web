<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord</title>
    <style>
        body {
            background: linear-gradient(135deg, #1d4ed8, #2563eb);
            font-family: Arial, sans-serif;
            color: #fff;
            text-align: center;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 5px 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }

        header h1 {
            font-size: 20px;
        }

        .menu {
            position: relative;
            display: inline-block;
        }

        .menu-button {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 16px;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .menu-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .menu-content {
            display: none;
            position: absolute;
            background-color: #fff;
            min-width: 200px;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            z-index: 1;
        }

        .menu-content a {
            color: #000;
            padding: 10px 20px;
            text-decoration: none;
            display: block;
        }

        .menu-content a:hover {
            background-color: #ddd;
        }

        .menu:hover .menu-content {
            display: block;
        }

        button {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 16px;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        table {
            margin: auto;
            width: 80%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 10px;
            border: none;
            text-align: center;
        }

        th {
            background: rgba(255, 255, 255, 0.3);
            font-size: 16px;
        }

        td {
            font-size: 14px;
        }

        /* Ajustement sp√©cifique des colonnes */
        th:nth-child(1), td:nth-child(1) {
            width: 5%; /* R√©duction de la largeur de "Position" */
        }

        th:nth-child(2), td:nth-child(2) {
            width: 20%; /* Augmentation de la largeur de "Jours dans le rang" */
        }

        .days-in-rank {
            color: #ff0; /* Couleur jaune pour les jours dans le rang */
        }
    </style>
</head>
<body>
<header>
    <h1>üîß Tableau de Bord</h1>
    <div class="menu">
        <button class="menu-button">Naviguer</button>
        <div class="menu-content">
            <a href="home.html">üè† Accueil</a>
            <a href="user-scores.html">üìà Mes Scores & Statistiques</a>
            <a href="user-settings.html">‚öôÔ∏è G√©rer Mon Compte</a>
            <a href="events.html">üìÖ √âv√©nements</a>
        </div>
    </div>
    <button onclick="logout()">üîí D√©connexion</button>
</header>
<main>
    <h2>üèÜ Classement des joueurs</h2>
    <table>
        <thead>
        <tr>
            <th>Position</th>
            <th>Jours dans le rang</th>
            <th>Date</th>
            <th>Pseudo</th>
            <th>Score</th>
        </tr>
        </thead>
        <tbody id="scoreTableBody">
        <!-- Les lignes seront ajout√©es ici dynamiquement -->
        </tbody>
    </table>
</main>
<script>
    const apiUrl = "/scores"; // Endpoint API pour r√©cup√©rer les scores
    let currentScores = []; // Stocke les scores actuels pour d√©tecter les changements
    const topPlayersDays = {}; // Stocke les jours dans le rang pour les 3 premiers

    async function loadScores() {
        try {
            const response = await fetch(apiUrl);
            const data = await response.json();

            // Trier les scores par ordre d√©croissant
            data.sort((a, b) => b.score - a.score);

            // V√©rifie si les scores ont chang√© avant d'actualiser
            if (JSON.stringify(data) !== JSON.stringify(currentScores)) {
                currentScores = data; // Met √† jour les scores actuels
                const tbody = document.getElementById("scoreTableBody");
                tbody.innerHTML = ""; // Efface les anciennes lignes

                const today = new Date().toISOString().split('T')[0]; // Date du jour au format YYYY-MM-DD

                data.forEach((entry, index) => {
                    const row = document.createElement("tr");

                    // Formater la date et l'heure
                    const date = new Intl.DateTimeFormat("fr-FR", {
                        timeZone: "Europe/Paris",
                        year: "numeric",
                        month: "short",
                        day: "numeric",
                        hour: "2-digit",
                        minute: "2-digit",
                    }).format(new Date(entry.timestamp));

                    // Si le joueur est dans le top 3, mettre √† jour le compteur de jours
                    let daysInRank = "";
                    if (index < 3) {
                        if (!topPlayersDays[entry.pseudo]) {
                            topPlayersDays[entry.pseudo] = { lastUpdated: today, days: 1 };
                        } else if (topPlayersDays[entry.pseudo].lastUpdated !== today) {
                            topPlayersDays[entry.pseudo].days += 1;
                            topPlayersDays[entry.pseudo].lastUpdated = today;
                        }
                        daysInRank = topPlayersDays[entry.pseudo].days;
                    }

                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td class="days-in-rank">${daysInRank || '-'}</td>
                        <td>${date}</td>
                        <td>${entry.pseudo || 'Anonyme'}</td>
                        <td>${entry.score}</td>
                    `;
                    tbody.appendChild(row);
                });

                // Supprimer les joueurs qui ne sont plus dans le top 3
                Object.keys(topPlayersDays).forEach(pseudo => {
                    if (!data.slice(0, 3).some(entry => entry.pseudo === pseudo)) {
                        delete topPlayersDays[pseudo];
                    }
                });
            }
        } catch (error) {
            console.error("Erreur lors du chargement des scores :", error);
        }
    }

    // Actualisation automatique toutes les 5 secondes
    setInterval(loadScores, 5000);

    // Charge automatiquement au d√©marrage
    loadScores();

    function logout() {
        window.location.href = "index.html";
    }
</script>
</body>
</html>
